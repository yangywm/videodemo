<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多直播间播放器</title>
    
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/8.23.3/video-js.css" rel="stylesheet" />
    
    <!-- 自定义样式 -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 16px;
        }
        .stream-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .stream-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        .stream-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .stream-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
        }
        .video-js {
            width: 100%;
            height: 300px;
        }
        .stream-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            color: #666;
        }
        .stream-url {
            display: block;
            max-width: 100%;
            white-space: nowrap;
            overflow-x: auto;
            text-overflow: ellipsis;
            cursor: pointer;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .control-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .control-btn:hover {
            background-color: #0056b3;
        }
        .control-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        @media (max-width: 768px) {
            .stream-container {
                grid-template-columns: 1fr;
            }
            body {
                padding: 10px;
            }
            .video-js {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔴 多直播间播放器</h1>
        <p>支持同时播放多个直播流</p>
    </div>
    <div class="controls">
        <button class="control-btn" onclick="playAllStreams()">播放全部</button>
        <button class="control-btn" onclick="pauseAllStreams()">暂停全部</button>
        <button class="control-btn" onclick="muteAllStreams()">静音全部</button>
        <button class="control-btn" onclick="unmuteAllStreams()">取消静音</button>
    </div>
    <div class="stream-container" id="streamContainer">
        <!-- 动态插入直播流卡片 -->
    </div>
    <!-- Video.js JavaScript -->
    <script src="https://vjs.zencdn.net/8.23.3/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@videojs/http-streaming@3.10.0/dist/videojs-http-streaming.min.js"></script>
    <script>
        // ====== 配置区 ======
        // 每行直播流数量
        const colCount = 4;
        // 行数变量（可随意更改）
        const rowCount = 2; // 你可以改成3、4等
        // 直播流数据（如需更多流，补充即可）
        const streamList = [
            {
                title: '直播间 1 ',
                src: 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
            },
            {
                title: '直播间 2 ',
                src: 'https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8',
            },
            {
                title: '直播间 3 ',
                src: 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8',
            },
            {
                title: '直播间 4 ',
                src: 'https://multiplatform-f.akamaihd.net/i/multi/will/bunny/big_buck_bunny_,640x360_400,640x360_700,640x360_1000,950x540_1500,.f4v.csmil/master.m3u8',
            },
            //
            {
                title: '直播间 5 ',
                src: 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
            },
            {
                title: '直播间 6 ',
                src: 'https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8',
            },
            {
                title: '直播间 7 ',
                src: 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8',
            },
            {
                title: '直播间 8 ',
                src: 'https://multiplatform-f.akamaihd.net/i/multi/will/bunny/big_buck_bunny_,640x360_400,640x360_700,640x360_1000,950x540_1500,.f4v.csmil/master.m3u8',
            },
            //
            // 如需更多流，继续添加
        ];
        // 自动补足streamList到rowCount*colCount个
        while (streamList.length < rowCount * colCount) {
            streamList.push({
                title: `直播间 ${streamList.length + 1}`,
                src: '', // 可留空或填默认流
            });
        }
        // ====== 动态渲染直播流卡片 ======
        function renderStreams() {
            const container = document.getElementById('streamContainer');
            container.innerHTML = '';
            for (let i = 0; i < rowCount * colCount; i++) {
                const stream = streamList[i];
                const streamId = `stream${i + 1}`; // 修复ID不匹配问题
                const statusId = `status${i + 1}`;
                // 只显示前6位+...+后28位
                let shortSrc = stream.src;
                if (shortSrc && shortSrc.length > 40) {
                    shortSrc = shortSrc.slice(0, 6) + '...' + shortSrc.slice(-34);
                }
                container.innerHTML += `
                <div class="stream-item">
                    <div class="stream-title">${stream.title} - ${streamId}</div>
                    <video-js
                        id="${streamId}"
                        class="video-js vjs-default-skin"
                        controls
                        preload="auto"
                        data-setup='{}'>
                        ${stream.src ? `<source src="${stream.src}" type="application/x-mpegURL">` : ''}
                        <p class="vjs-no-js">
                            To view this video please enable JavaScript, and consider upgrading to a web browser that
                            <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>.
                        </p>
                    </video-js>
                    <div class="stream-info">
                        <strong>状态:</strong> <span id="${statusId}">准备就绪</span><br>
                        <strong>直播流地址：</strong> <span class="stream-url" title="${stream.src}">${shortSrc}</span><br>
                    </div>
                </div>
                `;
            }
        }
        // ====== Video.js功能区 ======
        let players = {};
        function initializePlayers() {
            for (let i = 0; i < rowCount * colCount; i++) {
                const streamId = `stream${i + 1}`;
                const stream = streamList[i];
                
                // 设置视频源
                const sources = stream.src ? [{
                    src: stream.src,
                    type: 'application/x-mpegURL'
                }] : [];
                
                players[streamId] = videojs(streamId, {
                    fluid: true,
                    responsive: true,
                    playbackRates: [0.5, 1, 1.25, 1.5, 2],
                    controls: true,
                    preload: 'metadata',
                    html5: {
                        hls: {
                            enableLowInitialPlaylist: true,
                            smoothQualityChange: true,
                            overrideNative: true
                        }
                    },
                    techOrder: ['html5'],
                    sources: sources
                });
                players[streamId].on('loadstart', function() {
                    updateStatus(streamId, '加载中...');
                });
                players[streamId].on('canplay', function() {
                    updateStatus(streamId, '准备播放');
                });
                players[streamId].on('playing', function() {
                    updateStatus(streamId, '正在播放');
                });
                players[streamId].on('pause', function() {
                    updateStatus(streamId, '已暂停');
                });
                players[streamId].on('ended', function() {
                    updateStatus(streamId, '播放结束');
                });
                players[streamId].on('error', function(e) {
                    console.error(`播放器 ${streamId} 错误:`, e);
                    const error = players[streamId].error();
                    let errorMsg = '播放错误';
                    if (error) {
                        switch(error.code) {
                            case 1:
                                errorMsg = '播放错误: 用户中止';
                                break;
                            case 2:
                                errorMsg = '播放错误: 网络错误';
                                break;
                            case 3:
                                errorMsg = '播放错误: 解码错误';
                                break;
                            case 4:
                                errorMsg = '播放错误: 不支持的格式';
                                break;
                            default:
                                errorMsg = `播放错误: ${error.message || '未知错误'}`;
                        }
                    }
                    updateStatus(streamId, errorMsg);
                });
                players[streamId].on('waiting', function() {
                    updateStatus(streamId, '缓冲中...');
                });
            }
        }
        function updateStatus(streamId, status) {
            const statusElement = document.getElementById('status' + streamId.replace('stream', ''));
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.style.color = getStatusColor(status);
            }
        }
        function getStatusColor(status) {
            switch(status) {
                case '正在播放': return '#28a745';
                case '已暂停': return '#ffc107';
                case '播放错误': return '#dc3545';
                case '缓冲中...': return '#17a2b8';
                case '加载中...': return '#17a2b8';
                default: return '#6c757d';
            }
        }
        function playAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.play === 'function') {
                    player.play().catch(e => {
                        console.log('播放失败:', e);
                    });
                }
            });
        }
        function pauseAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.pause === 'function') {
                    player.pause();
                }
            });
        }
        function muteAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.muted === 'function') {
                    player.muted(true);
                }
            });
        }
        function unmuteAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.muted === 'function') {
                    player.muted(false);
                }
            });
        }
        document.addEventListener('DOMContentLoaded', function() {
            renderStreams();
            // 延迟初始化播放器，确保DOM完全渲染
            setTimeout(() => {
                initializePlayers();
                // 自动尝试加载有效的流
                loadValidStreams();
            }, 100);
        });
        
        // 加载有效的流
        function loadValidStreams() {
            Object.keys(players).forEach(streamId => {
                const player = players[streamId];
                const streamIndex = parseInt(streamId.replace('stream', '')) - 1;
                const stream = streamList[streamIndex];
                
                if (stream && stream.src && player) {
                    updateStatus(streamId, '检查流地址...');
                    // 尝试加载流
                    player.ready(() => {
                        player.src({
                            src: stream.src,
                            type: 'application/x-mpegURL'
                        });
                    });
                } else if (!stream.src) {
                    updateStatus(streamId, '无流地址');
                }
            });
        }
        window.addEventListener('beforeunload', function() {
            Object.values(players).forEach(player => {
                if (player && typeof player.dispose === 'function') {
                    player.dispose();
                }
            });
        });
    </script>
</body>
</html>