<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç›´æ’­é—´æ’­æ”¾å™¨</title>
    
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/8.23.3/video-js.css" rel="stylesheet" />
    
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 16px;
        }
        .stream-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .stream-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        .stream-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .stream-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
        }
        .video-js {
            width: 100%;
            height: 300px;
        }
        .stream-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            color: #666;
        }
        .stream-url {
            display: block;
            max-width: 100%;
            white-space: nowrap;
            overflow-x: auto;
            text-overflow: ellipsis;
            cursor: pointer;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .control-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .control-btn:hover {
            background-color: #0056b3;
        }
        .control-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        @media (max-width: 768px) {
            .stream-container {
                grid-template-columns: 1fr;
            }
            body {
                padding: 10px;
            }
            .video-js {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”´ å¤šç›´æ’­é—´æ’­æ”¾å™¨</h1>
        <p>æ”¯æŒåŒæ—¶æ’­æ”¾å¤šä¸ªç›´æ’­æµ</p>
    </div>
    <div class="controls">
        <button class="control-btn" onclick="playAllStreams()">æ’­æ”¾å…¨éƒ¨</button>
        <button class="control-btn" onclick="pauseAllStreams()">æš‚åœå…¨éƒ¨</button>
        <button class="control-btn" onclick="muteAllStreams()">é™éŸ³å…¨éƒ¨</button>
        <button class="control-btn" onclick="unmuteAllStreams()">å–æ¶ˆé™éŸ³</button>
    </div>
    <div class="stream-container" id="streamContainer">
        <!-- åŠ¨æ€æ’å…¥ç›´æ’­æµå¡ç‰‡ -->
    </div>
    <!-- Video.js JavaScript -->
    <script src="https://vjs.zencdn.net/8.23.3/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@videojs/http-streaming@3.10.0/dist/videojs-http-streaming.min.js"></script>
    <script>
        // ====== é…ç½®åŒº ======
        // æ¯è¡Œç›´æ’­æµæ•°é‡
        const colCount = 4;
        // è¡Œæ•°å˜é‡ï¼ˆå¯éšæ„æ›´æ”¹ï¼‰
        const rowCount = 2; // ä½ å¯ä»¥æ”¹æˆ3ã€4ç­‰
        // ç›´æ’­æµæ•°æ®ï¼ˆå¦‚éœ€æ›´å¤šæµï¼Œè¡¥å……å³å¯ï¼‰
        const streamList = [
            {
                title: 'ç›´æ’­é—´ 1 ',
                src: 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
            },
            {
                title: 'ç›´æ’­é—´ 2 ',
                src: 'https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8',
            },
            {
                title: 'ç›´æ’­é—´ 3 ',
                src: 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8',
            },
            {
                title: 'ç›´æ’­é—´ 4 ',
                src: 'https://multiplatform-f.akamaihd.net/i/multi/will/bunny/big_buck_bunny_,640x360_400,640x360_700,640x360_1000,950x540_1500,.f4v.csmil/master.m3u8',
            },
            //
            {
                title: 'ç›´æ’­é—´ 5 ',
                src: 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
            },
            {
                title: 'ç›´æ’­é—´ 6 ',
                src: 'https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8',
            },
            {
                title: 'ç›´æ’­é—´ 7 ',
                src: 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8',
            },
            {
                title: 'ç›´æ’­é—´ 8 ',
                src: 'https://multiplatform-f.akamaihd.net/i/multi/will/bunny/big_buck_bunny_,640x360_400,640x360_700,640x360_1000,950x540_1500,.f4v.csmil/master.m3u8',
            },
            //
            // å¦‚éœ€æ›´å¤šæµï¼Œç»§ç»­æ·»åŠ 
        ];
        // è‡ªåŠ¨è¡¥è¶³streamListåˆ°rowCount*colCountä¸ª
        while (streamList.length < rowCount * colCount) {
            streamList.push({
                title: `ç›´æ’­é—´ ${streamList.length + 1}`,
                src: '', // å¯ç•™ç©ºæˆ–å¡«é»˜è®¤æµ
            });
        }
        // ====== åŠ¨æ€æ¸²æŸ“ç›´æ’­æµå¡ç‰‡ ======
        function renderStreams() {
            const container = document.getElementById('streamContainer');
            container.innerHTML = '';
            for (let i = 0; i < rowCount * colCount; i++) {
                const stream = streamList[i];
                const streamId = `stream${i + 1}`; // ä¿®å¤IDä¸åŒ¹é…é—®é¢˜
                const statusId = `status${i + 1}`;
                // åªæ˜¾ç¤ºå‰6ä½+...+å28ä½
                let shortSrc = stream.src;
                if (shortSrc && shortSrc.length > 40) {
                    shortSrc = shortSrc.slice(0, 6) + '...' + shortSrc.slice(-34);
                }
                container.innerHTML += `
                <div class="stream-item">
                    <div class="stream-title">${stream.title} - ${streamId}</div>
                    <video-js
                        id="${streamId}"
                        class="video-js vjs-default-skin"
                        controls
                        preload="auto"
                        data-setup='{}'>
                        ${stream.src ? `<source src="${stream.src}" type="application/x-mpegURL">` : ''}
                        <p class="vjs-no-js">
                            To view this video please enable JavaScript, and consider upgrading to a web browser that
                            <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>.
                        </p>
                    </video-js>
                    <div class="stream-info">
                        <strong>çŠ¶æ€:</strong> <span id="${statusId}">å‡†å¤‡å°±ç»ª</span><br>
                        <strong>ç›´æ’­æµåœ°å€ï¼š</strong> <span class="stream-url" title="${stream.src}">${shortSrc}</span><br>
                    </div>
                </div>
                `;
            }
        }
        // ====== Video.jsåŠŸèƒ½åŒº ======
        let players = {};
        function initializePlayers() {
            for (let i = 0; i < rowCount * colCount; i++) {
                const streamId = `stream${i + 1}`;
                const stream = streamList[i];
                
                // è®¾ç½®è§†é¢‘æº
                const sources = stream.src ? [{
                    src: stream.src,
                    type: 'application/x-mpegURL'
                }] : [];
                
                players[streamId] = videojs(streamId, {
                    fluid: true,
                    responsive: true,
                    playbackRates: [0.5, 1, 1.25, 1.5, 2],
                    controls: true,
                    preload: 'metadata',
                    html5: {
                        hls: {
                            enableLowInitialPlaylist: true,
                            smoothQualityChange: true,
                            overrideNative: true
                        }
                    },
                    techOrder: ['html5'],
                    sources: sources
                });
                players[streamId].on('loadstart', function() {
                    updateStatus(streamId, 'åŠ è½½ä¸­...');
                });
                players[streamId].on('canplay', function() {
                    updateStatus(streamId, 'å‡†å¤‡æ’­æ”¾');
                });
                players[streamId].on('playing', function() {
                    updateStatus(streamId, 'æ­£åœ¨æ’­æ”¾');
                });
                players[streamId].on('pause', function() {
                    updateStatus(streamId, 'å·²æš‚åœ');
                });
                players[streamId].on('ended', function() {
                    updateStatus(streamId, 'æ’­æ”¾ç»“æŸ');
                });
                players[streamId].on('error', function(e) {
                    console.error(`æ’­æ”¾å™¨ ${streamId} é”™è¯¯:`, e);
                    const error = players[streamId].error();
                    let errorMsg = 'æ’­æ”¾é”™è¯¯';
                    if (error) {
                        switch(error.code) {
                            case 1:
                                errorMsg = 'æ’­æ”¾é”™è¯¯: ç”¨æˆ·ä¸­æ­¢';
                                break;
                            case 2:
                                errorMsg = 'æ’­æ”¾é”™è¯¯: ç½‘ç»œé”™è¯¯';
                                break;
                            case 3:
                                errorMsg = 'æ’­æ”¾é”™è¯¯: è§£ç é”™è¯¯';
                                break;
                            case 4:
                                errorMsg = 'æ’­æ”¾é”™è¯¯: ä¸æ”¯æŒçš„æ ¼å¼';
                                break;
                            default:
                                errorMsg = `æ’­æ”¾é”™è¯¯: ${error.message || 'æœªçŸ¥é”™è¯¯'}`;
                        }
                    }
                    updateStatus(streamId, errorMsg);
                });
                players[streamId].on('waiting', function() {
                    updateStatus(streamId, 'ç¼“å†²ä¸­...');
                });
            }
        }
        function updateStatus(streamId, status) {
            const statusElement = document.getElementById('status' + streamId.replace('stream', ''));
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.style.color = getStatusColor(status);
            }
        }
        function getStatusColor(status) {
            switch(status) {
                case 'æ­£åœ¨æ’­æ”¾': return '#28a745';
                case 'å·²æš‚åœ': return '#ffc107';
                case 'æ’­æ”¾é”™è¯¯': return '#dc3545';
                case 'ç¼“å†²ä¸­...': return '#17a2b8';
                case 'åŠ è½½ä¸­...': return '#17a2b8';
                default: return '#6c757d';
            }
        }
        function playAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.play === 'function') {
                    player.play().catch(e => {
                        console.log('æ’­æ”¾å¤±è´¥:', e);
                    });
                }
            });
        }
        function pauseAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.pause === 'function') {
                    player.pause();
                }
            });
        }
        function muteAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.muted === 'function') {
                    player.muted(true);
                }
            });
        }
        function unmuteAllStreams() {
            Object.values(players).forEach(player => {
                if (player && typeof player.muted === 'function') {
                    player.muted(false);
                }
            });
        }
        document.addEventListener('DOMContentLoaded', function() {
            renderStreams();
            // å»¶è¿Ÿåˆå§‹åŒ–æ’­æ”¾å™¨ï¼Œç¡®ä¿DOMå®Œå…¨æ¸²æŸ“
            setTimeout(() => {
                initializePlayers();
                // è‡ªåŠ¨å°è¯•åŠ è½½æœ‰æ•ˆçš„æµ
                loadValidStreams();
            }, 100);
        });
        
        // åŠ è½½æœ‰æ•ˆçš„æµ
        function loadValidStreams() {
            Object.keys(players).forEach(streamId => {
                const player = players[streamId];
                const streamIndex = parseInt(streamId.replace('stream', '')) - 1;
                const stream = streamList[streamIndex];
                
                if (stream && stream.src && player) {
                    updateStatus(streamId, 'æ£€æŸ¥æµåœ°å€...');
                    // å°è¯•åŠ è½½æµ
                    player.ready(() => {
                        player.src({
                            src: stream.src,
                            type: 'application/x-mpegURL'
                        });
                    });
                } else if (!stream.src) {
                    updateStatus(streamId, 'æ— æµåœ°å€');
                }
            });
        }
        window.addEventListener('beforeunload', function() {
            Object.values(players).forEach(player => {
                if (player && typeof player.dispose === 'function') {
                    player.dispose();
                }
            });
        });
    </script>
</body>
</html>